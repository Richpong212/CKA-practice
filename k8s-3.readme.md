# Kubernetes Exam README - Solution Guide

---

## ✅ Q1: Fix Pending Pod with Wrong Resource Unit

**Cluster:** `cluster3-controlplane`

**Task:**

- Pod `nginx-wl06` is stuck in Pending due to incorrect unit (Gi instead of Mi).
- Delete and recreate with `100Mi`.

**Solution:**

```bash
kubectl delete pod nginx-wl06
# Fix YAML to use 100Mi
kubectl apply -f nginx-wl06-fixed.yaml
```

---

## ✅ Q2: Remove Helm Chart with Vulnerable Image

**Cluster:** `cluster1-controlplane`

**Task:**

> On the cluster1, the team has installed multiple Helm charts in different namespaces.
> By mistake, one of the deployed resources includes a **vulnerable image** called:
>
> ```
> kodekloud/click-counter:latest
> ```
>
> Find out **which Helm release** is using this image and **uninstall it**.

**Solution:**

1. **Search for the vulnerable image:**

```bash
kubectl get pods -A -o jsonpath='{range .items[*]}{.metadata.namespace}{{"\t"}}{.metadata.name}{{"\t"}}{range .spec.containers[*]}{.image}{"\n"}{end}{end}' | grep kodekloud/click-counter
```

2. **Identify the Helm release:**

```bash
helm list -A
```

3. **Uninstall the release:**

```bash
helm uninstall web-dashboard-apd -n web-dashboard-03
```

4. **Verify the release is gone:**

```bash
helm list -A
```

---

## ✅ Q3: Create ClusterIP Service & Save Pod IPs

**Cluster:** `cluster3-controlplane`

**Part I:** Create service `service-3421-svcn` in `spectra-1267`

```bash
kubectl get pods -n spectra-1267 --show-labels
# Confirm pods: pod-21 & pod-23 → labels: mode=exam,type=external
kubectl create service clusterip service-3421-svcn -n spectra-1267 --tcp=8080:80 --dry-run=client -o yaml > service.yaml
# Edit selectors to mode=exam,type=external
kubectl apply -f service.yaml
```

**Part II:** Store sorted pod IPs

```bash
kubectl get pods -n spectra-1267 -o=custom-columns='POD_NAME:metadata.name,IP_ADDR:status.podIP' --sort-by=.status.podIP > /root/pod_ips_cka05_svcn
```

---

## ✅ Q4: List VPA CRDs

**Cluster:** `cluster2-controlplane`

```bash
echo "verticalpodautoscalercheckpoints.autoscaling.k8s.io" > /root/vpa-crds.txt
echo "verticalpodautoscalers.autoscaling.k8s.io" >> /root/vpa-crds.txt
```

---

## ✅ Q5: HPA for Deployment

**Cluster:** `cluster1-controlplane`

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: web-ui-hpa
  namespace: ck1967
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web-ui-deployment
  minReplicas: 2
  maxReplicas: 12
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 65
  behavior:
    scaleUp:
      policies:
        - type: Percent
          value: 20
          periodSeconds: 45
    scaleDown:
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
```

---

## ⏳ Q6: Troubleshoot Crashing Pod

**Cluster:** `cluster1-controlplane`

- Investigate `green-deployment-cka15-trb` crashing pods.
- Use `kubectl logs` and `kubectl describe pod` to fix.

---

## ✅ Q7: Create VPA for StatefulSet

**Cluster:** `cluster2-controlplane`

```yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: cache-vpa
  namespace: caching
spec:
  targetRef:
    apiVersion: apps/v1
    kind: StatefulSet
    name: cache-statefulset
  updatePolicy:
    updateMode: Initial
```

---

## ⏳ Q8: Add PVC to Pod

**Cluster:** `cluster1-controlplane`

- Update `/root/peach-pod-cka05-str.yaml` to:

  - Add `peach-pvc-cka05-str` claiming 100Mi from `peach-pv-cka05-str`
  - Mount to `/var/www/html`

---

## ⏳ Q9: HTTPRoute Traffic Split

**Cluster:** `cluster2-controlplane`

- Create `HTTPRoute` in `cka3658` namespace.
- Route 80% to `web-portal-service-v1` and 20% to `web-portal-service-v2`.

---

## ⏳ Q10: Fix Pending Pod

**Cluster:** `cluster1-controlplane`

- Pod `demo-pod-cka29-trb` is Pending
- Run `kubectl describe pod` to determine issue and fix.

---

## ⏳ Q11: Add PVC + Sidecar

**Cluster:** `cluster1-controlplane`

- YAML file: `/root/olive-app-cka10-str.yaml`
- Add:

  - PVC: `olive-pvc-cka10-str`
  - Sidecar `busybox` with sleep, read-only mount at `/usr/src`

---

## ⏳ Q12: Stop Scheduler Temporarily

**Cluster:** `cluster2-controlplane`

- Stop scheduler
- Create `onyx-pod` (runs on controlplane)
- Restart scheduler
- Create `ember-pod` (runs on node01)

---

## ⏳ Q13: KCM Restart Issue

**Cluster:** `cluster4-controlplane`

- Investigate kube-controller-manager crashes
- Check logs, systemd units, certificates, etc.

---

## ⏳ Q14: External Web Server Service Not Working

**Cluster:** `cluster3-controlplane`

- Fix `external-webserver-cka03-svcn` service to reach external IP (student-node:9999)

---

## ✅ Q15: Create ConfigMap from File

**Cluster:** `cluster1-controlplane`

```bash
kubectl create configmap db-user-pass-cka17-arch --from-file=/opt/db-user-pass
```

---

## ⏳ Q16: NetworkPolicy Too Restrictive

**Cluster:** `cluster1-controlplane`

- Pod: `cyan-pod-cka28-trb` in `cyan-ns-cka28-trb`
- Accessible **only** from `cyan-white-cka28-trb`
- Update `cyan-np-cka28-trb` to allow correct traffic
